{"version":3,"sources":["src/gatsby-node.ts"],"names":["pluginOptionsSchema","args","Joi","object","buildMarkdownNodes","boolean","description","default","downloadLocalImages","downloadAllAssets","skipUnusedAssets","endpoint","string","required","fragmentsPath","locales","array","items","min","stages","token","typePrefix","maxImageWidth","number","integer","concurrency","createExecutor","gatsbyApi","pluginOptions","reporter","defaultStage","length","execute","operationName","query","variables","method","body","JSON","stringify","headers","Authorization","then","response","ok","panic","Error","statusText","json","errors","catch","error","retrieveSchema","schema","nodeInterface","getType","queryFields","getFields","possibleTypes","getPossibleTypes","singularRootFieldName","type","Object","keys","find","fieldName","pluralRootFieldName","String","name","hasLocaleField","locale","gatsbyNodeTypes","map","remoteTypeName","queries","stage","join","nodeQueryVariables","id","where","createSourcingConfig","schemaConfig","fragmentsDir","process","cwd","fs","existsSync","mkdirSync","addSystemFieldArguments","field","includes","variation","fragments","defaultArgumentValues","documents","customFragments","gatsbyTypePrefix","gatsbyNodeDefs","createResolvers","resolvers","localFile","resolve","source","context","info","children","file","nodeModel","getNodeById","sourceNodes","config","createImageUrl","url","maxWidth","parsed","URL","hostname","resized","pathname","verbose","isAssetUsed","node","fields","entries","remoteId","used","key","value","Array","isArray","entry","shownMarkdownWarning","onCreateNode","actions","createNode","createParentChildLink","createNodeId","getCache","store","isImage","width","height","size","warn","fileName","realUrl","ext","path","extname","basename","localNodeId","fileNode","parentNodeId","cache","undefined","localNode","parent","internal","owner","contentDigest","child","e","console","filter","forEach","decodedMarkdown","markdown","markdownNode","mediaType","content","crypto","createHash","update","digest","customiseSchema","createTypes","gatsbyNodeType","createSchemaCustomization"],"mappings":"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","sourcesContent":["import crypto from \"crypto\";\r\nimport fs from \"fs\";\r\nimport path from \"path\";\r\nimport {\r\n  wrapQueryExecutorWithQueue,\r\n  loadSchema,\r\n  readOrGenerateDefaultFragments,\r\n  compileNodeQueries,\r\n  buildNodeDefinitions,\r\n  createSchemaCustomization as createToolkitSchemaCustomization,\r\n  sourceAllNodes,\r\n} from \"gatsby-graphql-source-toolkit\";\r\nimport { createRemoteFileNode } from \"gatsby-source-filesystem\";\r\nimport { decode } from \"he\";\r\nimport fetch from \"node-fetch\";\r\nimport { ObjectSchema } from \"gatsby-plugin-utils\";\r\nimport {\r\n  Actions,\r\n  CreateNodeArgs,\r\n  CreateResolversArgs,\r\n  CreateSchemaCustomizationArgs,\r\n  Node,\r\n  NodePluginArgs,\r\n  ParentSpanPluginArgs,\r\n  PluginOptions,\r\n  PluginOptionsSchemaArgs,\r\n  Reporter,\r\n  SourceNodesArgs,\r\n} from \"gatsby\";\r\nimport {\r\n  GraphQLAbstractType,\r\n  GraphQLInterfaceType,\r\n  GraphQLSchema,\r\n} from \"graphql\";\r\nimport {\r\n  IGatsbyNodeConfig,\r\n  IGatsbyNodeDefinition,\r\n  IQueryExecutor,\r\n  ISourcingConfig,\r\n  RemoteTypeName,\r\n} from \"gatsby-graphql-source-toolkit/dist/types\";\r\n\r\nexport function pluginOptionsSchema(\r\n  args: PluginOptionsSchemaArgs\r\n): ObjectSchema {\r\n  const { Joi } = args;\r\n  return Joi.object({\r\n    buildMarkdownNodes: Joi.boolean()\r\n      .description(\r\n        `Build markdown nodes for all [RichText](https://graphcms.com/docs/reference/fields/rich-text) fields in your GraphCMS schema`\r\n      )\r\n      .default(false),\r\n    downloadLocalImages: Joi.boolean()\r\n      .description(\r\n        `Download and cache GraphCMS image assets in your Gatsby project`\r\n      )\r\n      .default(false),\r\n    downloadAllAssets: Joi.boolean()\r\n      .description(\r\n        `Download and cache all GraphCMS assets in your Gatsby project`\r\n      )\r\n      .default(false),\r\n    skipUnusedAssets: Joi.boolean()\r\n      .description(\"Skip unused assets\")\r\n      .default(true),\r\n    endpoint: Joi.string()\r\n      .description(\r\n        `The endpoint URL for the GraphCMS project. This can be found in the [project settings UI](https://graphcms.com/docs/guides/concepts/apis#working-with-apis)`\r\n      )\r\n      .required(),\r\n    fragmentsPath: Joi.string()\r\n      .description(\r\n        `The local project path where generated query fragments are saved. This is relative to your current working directory. If using multiple instances of the source plugin, you **must** provide a value here to prevent type and/or fragment conflicts.`\r\n      )\r\n      .default(`graphcms-fragments`),\r\n    locales: Joi.array()\r\n      .description(\r\n        `An array of locale key strings from your GraphCMS project. You can read more about working with localisation in GraphCMS [here](https://graphcms.com/docs/guides/concepts/i18n).`\r\n      )\r\n      .items(Joi.string())\r\n      .min(1)\r\n      .default([\"en\"]),\r\n    stages: Joi.array()\r\n      .description(\r\n        `An array of Content Stages from your GraphCMS project. You can read more about using Content Stages [here](https://graphcms.com/guides/working-with-content-stages).`\r\n      )\r\n      .items(Joi.string())\r\n      .min(1)\r\n      .default([\"PUBLISHED\"]),\r\n    token: Joi.string().description(\r\n      `If your GraphCMS project is **not** publicly accessible, you will need to provide a [Permanent Auth Token](https://graphcms.com/docs/reference/authorization) to correctly authorize with the API. You can learn more about creating and managing API tokens [here](https://graphcms.com/docs/guides/concepts/apis#working-with-apis)`\r\n    ),\r\n    typePrefix: Joi.string()\r\n      .description(\r\n        `The string by which every generated type name is prefixed with. For example, a type of Post in GraphCMS would become GraphCMS_Post by default. If using multiple instances of the source plugin, you **must** provide a value here to prevent type conflicts`\r\n      )\r\n      .default(`GraphCMS_`),\r\n    maxImageWidth: Joi.number()\r\n      .description(\"Maximum width of images to download\")\r\n      .integer()\r\n      .default(0),\r\n    concurrency: Joi.number()\r\n      .integer()\r\n      .min(1)\r\n      .default(10)\r\n      .description(\"The number of promises to run at one time\"),\r\n  });\r\n}\r\n\r\ninterface RealPluginOptions extends PluginOptions {\r\n  buildMarkdownNodes: boolean;\r\n  downloadLocalImages: boolean;\r\n  downloadAllAssets: boolean;\r\n  endpoint: string;\r\n  fragmentsPath: string;\r\n  stages: string[];\r\n  token: string;\r\n  typePrefix: string;\r\n  locales: string[];\r\n  maxImageWidth: number;\r\n  skipUnusedAssets: boolean;\r\n  concurrency: number;\r\n}\r\n\r\nfunction createExecutor(\r\n  gatsbyApi: NodePluginArgs,\r\n  pluginOptions: RealPluginOptions\r\n): IQueryExecutor {\r\n  const { endpoint, fragmentsPath, locales, stages, token, typePrefix } =\r\n    pluginOptions;\r\n  const { reporter } = gatsbyApi;\r\n  const defaultStage = stages && stages.length === 1 && stages[0];\r\n  const execute = async ({ operationName, query, variables = {} }) => {\r\n    return await fetch(endpoint, {\r\n      method: \"POST\",\r\n      body: JSON.stringify({ query, variables, operationName }),\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n        ...(defaultStage && { \"gcms-stage\": defaultStage }),\r\n        ...(token && { Authorization: `Bearer ${token}` }),\r\n      },\r\n    })\r\n      .then((response) => {\r\n        if (!response.ok) {\r\n          return reporter.panic(\r\n            `gatsby-source-graphcms: Problem building GraphCMS nodes`,\r\n            new Error(response.statusText)\r\n          );\r\n        }\r\n\r\n        return response.json();\r\n      })\r\n      .then((response) => {\r\n        if (response.errors) {\r\n          return reporter.panic(\r\n            `gatsby-source-graphcms: Problem building GraphCMS nodes`,\r\n            new Error(response.errors)\r\n          );\r\n        }\r\n\r\n        return response;\r\n      })\r\n      .catch((error) => {\r\n        return reporter.panic(\r\n          `gatsby-source-graphcms: Problem building GraphCMS nodes`,\r\n          new Error(error)\r\n        );\r\n      });\r\n  };\r\n  return execute;\r\n}\r\n\r\ninterface ISchemaInformation {\r\n  schema: GraphQLSchema;\r\n  gatsbyNodeTypes: IGatsbyNodeConfig[];\r\n}\r\n\r\nasync function retrieveSchema(\r\n  gatsbyApi: NodePluginArgs,\r\n  pluginOptions: RealPluginOptions\r\n): Promise<ISchemaInformation> {\r\n  const { locales, stages } = pluginOptions;\r\n  const execute = createExecutor(gatsbyApi, pluginOptions);\r\n  const schema = await loadSchema(execute);\r\n\r\n  const nodeInterface = schema.getType(\"Node\") as GraphQLAbstractType;\r\n  const query = schema.getType(\"Query\") as GraphQLInterfaceType;\r\n  const queryFields = query.getFields();\r\n  const possibleTypes = schema.getPossibleTypes(nodeInterface);\r\n\r\n  const singularRootFieldName = (type) =>\r\n    Object.keys(queryFields).find(\r\n      (fieldName) => queryFields[fieldName].type === type\r\n    );\r\n\r\n  const pluralRootFieldName = (type) =>\r\n    Object.keys(queryFields).find(\r\n      (fieldName) => String(queryFields[fieldName].type) === `[${type.name}!]!`\r\n    );\r\n\r\n  const hasLocaleField = (type) => type.getFields().locale;\r\n\r\n  const gatsbyNodeTypes: IGatsbyNodeConfig[] = possibleTypes.map((type) => ({\r\n    remoteTypeName: type.name,\r\n    queries: [\r\n      ...locales.map((locale) =>\r\n        stages.map(\r\n          (stage) => `\r\n          query LIST_${pluralRootFieldName(\r\n            type\r\n          )}_${locale}_${stage} { ${pluralRootFieldName(type)}(first: $limit, ${\r\n            hasLocaleField(type) ? `locales: [${locale}, ${locales[0]}]` : \"\"\r\n          }, skip: $offset, stage: ${stage}) {\r\n              ..._${type.name}Id_\r\n            }\r\n          }`\r\n        )\r\n      ),\r\n      `query NODE_${singularRootFieldName(type)}{ ${singularRootFieldName(\r\n        type\r\n      )}(where: $where, ${hasLocaleField(type) ? `locales: $locales` : \"\"}) {\r\n        ..._${type.name}Id_\r\n        }\r\n      }\r\n      fragment _${type.name}Id_ on ${type.name} {\r\n        __typename\r\n        id\r\n        ${hasLocaleField(type) ? `locale` : \"\"}\r\n        stage\r\n      }`,\r\n    ].join(\"\\n\"),\r\n    nodeQueryVariables: ({ id, locale, stage }) => ({\r\n      where: { id },\r\n      locales: [locale],\r\n      stage,\r\n    }),\r\n  }));\r\n\r\n  return { schema, gatsbyNodeTypes };\r\n}\r\n\r\nasync function createSourcingConfig(\r\n  schemaConfig: ISchemaInformation,\r\n  gatsbyApi: ParentSpanPluginArgs,\r\n  pluginOptions: RealPluginOptions\r\n): Promise<ISourcingConfig> {\r\n  const { fragmentsPath, stages, typePrefix, concurrency } = pluginOptions;\r\n  const { reporter } = gatsbyApi;\r\n  const defaultStage = stages && stages.length === 1 && stages[0];\r\n\r\n  const execute = createExecutor(gatsbyApi, pluginOptions);\r\n  const { schema, gatsbyNodeTypes } = schemaConfig;\r\n\r\n  const fragmentsDir = `${process.cwd()}/${fragmentsPath}`;\r\n\r\n  if (!fs.existsSync(fragmentsDir)) fs.mkdirSync(fragmentsDir);\r\n\r\n  const addSystemFieldArguments = (field) => {\r\n    if ([\"createdAt\", \"publishedAt\", \"updatedAt\"].includes(field.name)) {\r\n      return { variation: `COMBINED` };\r\n    }\r\n  };\r\n\r\n  const fragments = await readOrGenerateDefaultFragments(fragmentsDir, {\r\n    schema,\r\n    gatsbyNodeTypes,\r\n    defaultArgumentValues: [addSystemFieldArguments],\r\n  });\r\n\r\n  const documents = compileNodeQueries({\r\n    schema,\r\n    gatsbyNodeTypes,\r\n    customFragments: fragments,\r\n  });\r\n\r\n  return {\r\n    gatsbyApi,\r\n    schema,\r\n    execute: wrapQueryExecutorWithQueue(execute, { concurrency }),\r\n    gatsbyTypePrefix: typePrefix,\r\n    gatsbyNodeDefs: buildNodeDefinitions({ gatsbyNodeTypes, documents }),\r\n  };\r\n}\r\n\r\nexport function createResolvers(\r\n  args: CreateResolversArgs,\r\n  pluginOptions: RealPluginOptions\r\n): void {\r\n  const { createResolvers, reporter } = args;\r\n  const { typePrefix } = pluginOptions;\r\n\r\n  const resolvers = {\r\n    [`${typePrefix}Asset`]: {\r\n      localFile: {\r\n        type: \"File\",\r\n        resolve(source: GraphCMS_Node, args, context, info) {\r\n          if (source.children?.length) {\r\n            for (const id of source.children) {\r\n              const file = context.nodeModel.getNodeById({ id, type: \"File\" });\r\n              if (file) {\r\n                return file;\r\n              }\r\n            }\r\n          }\r\n        },\r\n      },\r\n    },\r\n  };\r\n  createResolvers(resolvers);\r\n}\r\n\r\nexport async function sourceNodes(\r\n  gatsbyApi: SourceNodesArgs,\r\n  pluginOptions: RealPluginOptions\r\n) {\r\n  const schemaConfig = await retrieveSchema(gatsbyApi, pluginOptions);\r\n  const config = await createSourcingConfig(\r\n    schemaConfig,\r\n    gatsbyApi,\r\n    pluginOptions\r\n  );\r\n  await sourceAllNodes(config);\r\n}\r\n\r\nfunction createImageUrl(url: string, maxWidth: number, reporter: Reporter) {\r\n  if (!maxWidth) {\r\n    return url;\r\n  }\r\n\r\n  const parsed = new URL(url);\r\n  if (parsed.hostname !== \"media.graphcms.com\") {\r\n    return url;\r\n  }\r\n\r\n  const resized = `https://${parsed.hostname}/resize=width:${maxWidth},fit:max${parsed.pathname}`;\r\n  reporter.verbose(`Using ${resized} for ${url}`);\r\n  return resized;\r\n}\r\n\r\nfunction isAssetUsed(node: GraphCMS_Node, reporter: Reporter) {\r\n  const fields = Object.entries(node);\r\n  const remoteId = node.remoteId;\r\n  if (!remoteId) return false;\r\n  let used = false;\r\n  for (const [key, value] of fields) {\r\n    if (Array.isArray(value)) {\r\n      for (const entry of value as AssetReference[]) {\r\n        if (entry.remoteId) {\r\n          // reporter.verbose(`${node.fileName} used by ${entry.remoteTypeName}`);\r\n          used = true;\r\n          break;\r\n        }\r\n      }\r\n    }\r\n    if (used) {\r\n      break;\r\n    }\r\n  }\r\n  return used;\r\n}\r\n\r\ninterface AssetReference {\r\n  remoteTypeName: string;\r\n  remoteId: string;\r\n  stage: string;\r\n  locale: string;\r\n}\r\n\r\ntype GraphCMS_Node = Node & {\r\n  mimeType: string;\r\n  url: string;\r\n  remoteTypeName?: string;\r\n  remoteId?: string;\r\n  markdown?: string;\r\n  fileName: string;\r\n  height?: number;\r\n  width?: number;\r\n  size: number;\r\n  stage: string;\r\n  locale: string;\r\n};\r\n\r\nlet shownMarkdownWarning = false;\r\n\r\nexport async function onCreateNode(\r\n  args: CreateNodeArgs<GraphCMS_Node>,\r\n  pluginOptions: RealPluginOptions\r\n) {\r\n  const {\r\n    node,\r\n    actions: { createNode, createParentChildLink },\r\n    createNodeId,\r\n    getCache,\r\n    store,\r\n    reporter,\r\n  } = args;\r\n  const {\r\n    buildMarkdownNodes,\r\n    downloadAllAssets,\r\n    downloadLocalImages,\r\n    typePrefix,\r\n    maxImageWidth,\r\n    skipUnusedAssets,\r\n  } = pluginOptions;\r\n\r\n  const isImage = node.remoteTypeName === \"Asset\" && node.width && node.height;\r\n\r\n  if (\r\n    node.remoteTypeName === \"Asset\" &&\r\n    (downloadAllAssets || (downloadLocalImages && isImage))\r\n  ) {\r\n    if (skipUnusedAssets && !isAssetUsed(node, reporter)) {\r\n      // reporter.verbose(\r\n      //   `Skipping unused asset ${node.fileName} ${node.remoteId}`\r\n      // );\r\n    } else {\r\n      if (node.size > 10 * 1024 * 1024) {\r\n        reporter.warn(\r\n          `Asset ${node.fileName} ${node.remoteId} is too large: ${node.size}`\r\n        );\r\n      }\r\n\r\n      try {\r\n        const realUrl =\r\n          isImage && maxImageWidth && node.width > maxImageWidth\r\n            ? createImageUrl(node.url, maxImageWidth, reporter)\r\n            : node.url;\r\n        const ext = node.fileName && path.extname(node.fileName);\r\n        const name = node.fileName && path.basename(node.fileName, ext);\r\n        const localNodeId = createNodeId(`${node.id} >> LocalFile`);\r\n        const fileNode = await createRemoteFileNode({\r\n          url: realUrl,\r\n          parentNodeId: node.id,\r\n          createNode,\r\n          createNodeId,\r\n          getCache,\r\n          cache: undefined,\r\n          store,\r\n          reporter,\r\n          name,\r\n          ext,\r\n        } as any);\r\n        const localNode = {\r\n          id: localNodeId,\r\n          children: [],\r\n          parent: node.id,\r\n          internal: {\r\n            type: \"LocalAsset\",\r\n            owner: \"\",\r\n            contentDigest: fileNode.internal.contentDigest,\r\n          },\r\n        };\r\n\r\n        // if (fileNode) {\r\n        //   node.localFile = fileNode.id;\r\n        // }\r\n        // createNode(localNode);\r\n        // createParentChildLink({ parent: localNode, child: fileNode });\r\n        // createParentChildLink({ parent: node, child: localNode });\r\n        createParentChildLink({ parent: node, child: fileNode });\r\n      } catch (e) {\r\n        console.error(\"gatsby-source-graphcms:\", e);\r\n      }\r\n    }\r\n  }\r\n\r\n  if (buildMarkdownNodes) {\r\n    const fields = Object.entries(node)\r\n      .map(([key, value]) => ({ key, value }))\r\n      .filter(\r\n        ({ value }) => value && (value as any)?.remoteTypeName === \"RichText\"\r\n      );\r\n\r\n    if (fields.length) {\r\n      fields.forEach((field) => {\r\n        const decodedMarkdown: string = decode((field.value as any).markdown);\r\n\r\n        const markdownNode = {\r\n          id: `MarkdownNode:${createNodeId(`${node.id}-${field.key}`)}`,\r\n          parent: node.id,\r\n          internal: {\r\n            type: `${typePrefix}MarkdownNode`,\r\n            mediaType: \"text/markdown\",\r\n            content: decodedMarkdown,\r\n            contentDigest: crypto\r\n              .createHash(`md5`)\r\n              .update(decodedMarkdown)\r\n              .digest(`hex`),\r\n          },\r\n        };\r\n\r\n        createNode(markdownNode);\r\n\r\n        (field.value as any).markdownNode = markdownNode.id;\r\n        if (!shownMarkdownWarning) {\r\n          shownMarkdownWarning = true;\r\n          reporter.warn(\r\n            \"Mutated node for markdown - not supported in v4 or LMDB_STORE\"\r\n          );\r\n        }\r\n      });\r\n    }\r\n  }\r\n}\r\n\r\nfunction customiseSchema(\r\n  { createTypes }: Actions,\r\n  { typePrefix }: RealPluginOptions,\r\n  { gatsbyNodeTypes }: ISchemaInformation\r\n) {\r\n  gatsbyNodeTypes.forEach((gatsbyNodeType) => {\r\n    createTypes(`type ${typePrefix}${gatsbyNodeType.remoteTypeName} implements Node {\r\n      updatedAt: Date! @dateformat\r\n      createdAt: Date! @dateformat\r\n      publishedAt: Date @dateformat\r\n    }`);\r\n  });\r\n}\r\n\r\nexport async function createSchemaCustomization(\r\n  gatsbyApi: CreateSchemaCustomizationArgs,\r\n  pluginOptions: RealPluginOptions\r\n) {\r\n  const {\r\n    buildMarkdownNodes,\r\n    downloadAllAssets,\r\n    downloadLocalImages,\r\n    typePrefix,\r\n    defaultStage,\r\n  } = pluginOptions;\r\n  const { actions, reporter } = gatsbyApi;\r\n  const { createTypes } = actions;\r\n  if (defaultStage) {\r\n    reporter.info(`using default GraphCMS stage: ${defaultStage}`);\r\n  } else {\r\n    reporter.info(`no default stage for GraphCMS`);\r\n  }\r\n\r\n  const schemaConfig = await retrieveSchema(gatsbyApi, pluginOptions);\r\n  const config = await createSourcingConfig(\r\n    schemaConfig,\r\n    gatsbyApi,\r\n    pluginOptions\r\n  );\r\n  customiseSchema(actions, pluginOptions, schemaConfig);\r\n  await createToolkitSchemaCustomization(config);\r\n\r\n  // if (downloadLocalImages || downloadAllAssets)\r\n  //   createTypes(`\r\n  //     type ${typePrefix}Asset {\r\n  //       localFile: File @link\r\n  //       childFile: File @link\r\n  //       childImageSharp: ImageSharp @link\r\n\r\n  //     }\r\n  //   `);\r\n\r\n  // localAsset: LocalAsset @link\r\n  if (buildMarkdownNodes)\r\n    createTypes(`\r\n      type ${typePrefix}MarkdownNode implements Node {\r\n        id: ID!\r\n      }\r\n      type ${typePrefix}RichText {\r\n        markdownNode: ${typePrefix}MarkdownNode @link\r\n      }\r\n    `);\r\n}\r\n"],"file":"gatsby-node.js"}